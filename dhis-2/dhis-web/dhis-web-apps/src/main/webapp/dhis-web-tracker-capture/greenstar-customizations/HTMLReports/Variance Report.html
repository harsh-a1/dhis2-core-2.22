<script type="text/javascript">

    var periods = dhis2.report.periods;
    var period = periods[0];
    var orgUnit = dhis2.report.organisationUnit;
    orgUnit.parent = dhis2.report.organisationUnitHierarchy[1];
    var orgUnitChildren = dhis2.report.organisationUnitChildren;
    var orgUnitUIDs = "";


    var prgUID = "TbYUPaBChYR";
    var def_stage1,def_stage2,def_stage3,def_stage4,def_stage5,def_stage6;
    var tableDataHtml, tableDataHtml1, tableDataHtml2,tableDataHtml3,tableDataHtml4,tableDataHtml5;
    var stage1 ="pPdawAo0LkG"; //IPC workplan
    var stage2 ="OMHUToxZR03"; //orientation meeting
    var stage3="mDwBhWDmLfr"; //neighbourhood meeting
    var stage4 ="n2CFuvwUvnh"; //House hold
    var stage5 ="k7gHjJ4LFOU"; //AM
    var stage6 = "hVVdocIy72g"; // follow up
    var variance;
    var orgnUnit ="tZJsIdHAfKq";
    var j;
    if (jQuery.when.all === undefined) {
        jQuery.when.all = function (deferreds) {
            var deferred = new jQuery.Deferred();
            $.when.apply(jQuery, deferreds).then(
                    function () {
                        deferred.resolve(Array.prototype.slice.call(arguments));
                    },
                    function () {
                        deferred.fail(Array.prototype.slice.call(arguments));
                    });

            return deferred;
        }
    }


    var tableDX = [


        { dxName: "PK RH FP-Clients followed-up", dxId: "NoGwMfqdSOY", cocId: "" },
        { dxName: "PK RH FP-IPC FFM first client MWRA ID", dxId: "qbK1eGEgVD4", cocId: "" },
        { dxName: "PK RH FP-IPC FFM referral tokens issued", dxId: "gBdx1XMCySe", cocId: "" },
        { dxName: "PK RH FP IPC FFM last client MWRA ID", dxId: "vKpDeWYKhHk", cocId: "" },
        { dxName: "PK RH FP-Orientation meeting participants", dxId: "Pusk3tS9CEP", cocId: "" },
        { dxName: "PK RH FP-Neighbourhood meeting participants", dxId: "dvLvzUaJeQh", cocId: "" },
        { dxName: "PK RH FP-IPC FFM clients visited", dxId: "nUqWTyxWCZs", cocId: "" }
    ];


    var deUIDs = "";

    var url = window.location.href;
    var params = url.split('=');
    var gotPeriod = params[2];
    var showingTable = "datavalue1";

    jQuery(document).ready(function () {
        $.get("../api/trackedEntityInstances.json?ou=tZJsIdHAfKq&ouMode=DESCENDANTS&trackedEntity=lLKXYUBAAMy", function (json3) {


            $.each(json3.trackedEntityInstances, function (index, item) {
                $.each(item.attributes, function (index1, item1) {

                    if (item1.code == "Firstname") {
                        $('#workerdropdown').append(
                                $('<option></option>').val(item.trackedEntityInstance).html(item1.value).text(item1.value)
                        );
                    }
                });
            });

        });
        //validateReport();
        $(".hideInPrint").hide();
        orgUnitChildren.sort(function (a, b) {
            if (a.name < b.name)
                return -1;
            if (a.name > b.name)
                return 1;
            return 0;
        });

        $.each(tableDX, function () {
            deUIDs += this.dxId + ";";
        });

        $.each(orgUnitChildren, function () {
            orgUnitUIDs += this.id + ";";
        });

        //    loadDataX();
        $("#datepicker").datepicker({dateFormat: "dd/mm/yy"});
        $("#datepicker1").datepicker({dateFormat: "dd/mm/yy"});


        $("#btnExport").click(function (e) {
            window.open('data:application/vnd.ms-excel,' + encodeURIComponent($('#printing').html()));
            e.preventDefault();
        });

    });
    function hideLoad() {
        document.getElementById("cover").style.display = "none";
        document.getElementById("loads").style.display = "none";
        document.getElementById("loading").style.display = "none";
        document.getElementsByTagName("body")[0].style.overflow = "scroll";
    }

    function validateReport() {
        $.get("../api/organisationUnitGroups/hdvIWjIWixd?filter=organisationUnits.id:eq:" + orgUnit.id, function (json) {

            if (!json.name) {
                alert("Selected Facility is not in Intervention OU Group");
                window.history.back();
            }
            else {
                loadData();
            }
        });
    }


    function getPeriod(pr) {
        var year = pr.substring(0, 4);
        var month = pr.substring(4, 6);
        var strMonth = "";

        if (month == "01" || month == "1")        strMonth = "January";
        else if (month == "02" || month == "2")    strMonth = "February";
        else if (month == "03" || month == "3")    strMonth = "March";
        else if (month == "04" || month == "4")    strMonth = "April";
        else if (month == "05" || month == "5")    strMonth = "May";
        else if (month == "06" || month == "6")    strMonth = "June";
        else if (month == "07" || month == "7")    strMonth = "July";
        else if (month == "08" || month == "8")    strMonth = "August";
        else if (month == "09" || month == "9")    strMonth = "September";
        else if (month == "10")                strMonth = "October";
        else if (month == "11")                strMonth = "November";
        else if (month == "12")                strMonth = "December";

        return strMonth + " " + year;
    }

    var periodArray = [];
    //  var cYear = parseInt(gotPeriod.substring(0, 4));
    // var cMonth = parseInt(gotPeriod.substring(4, 6));
    //  var periodsStr = gotPeriod.substring(0, 4) + "" + gotPeriod.substring(4, 6);

    var jsonData1;
    var jsonData2;
    var jsonData3;
    var c = 0;

    function loadData() {
        document.getElementById('selectedOUName').innerHTML = orgUnit.name;
        document.getElementById('period').innerHTML = getPeriod(gotPeriod);

        //http://localhost:8090/dhis221/api/analytics.json?dimension=pe:THIS_MONTH&dimension=dx:fftwX6D3iuI;vMISOrzIDPL;Y3sftYIwjSx;Nr8JvumTkmZ;lO9hVUqHo9v;xi0iWC3fLH5;XWBvNBGaek0;xJbKdiq41l3&dimension=ou:Xyeh1Hkiz0i;IsDCrC4yKIB;VKvtcjd4XC3;R0DM4NKU4iX;gXg0zlcO1Xt;EjHkVXiw2tR;b0rHfpNxUUm;zUGO5Ho7Aqb&program=icAx8KDM1WT
        var url = "../api/analytics.json?dimension=dx:" + deUIDs + "&dimension=ou:" + orgUnitUIDs + "&dimension=pe:" + periodsStr + "&program=" + prgUID;

        console.log(url);
        $.get(url, function (json) {


            console.log("************************URL: " + url);

            jsonData1 = json;
            //console.log( jsonData1 );

            loadReport();
        });

    }

    function prepareIdToObjectMap(object, id) {
        var map = [];
        for (var i = 0; i < object.length; i++) {
            map[object[i][id]] = object[i];
        }
        return map;
    }

    function loadDataX() {
        //
        def_stage1 = $.Deferred();
        def_stage2 = $.Deferred();
        def_stage3 = $.Deferred();
        def_stage4 = $.Deferred();
        def_stage5 = $.Deferred();
        def_stage6 = $.Deferred();

        var a = document.getElementById('datepicker').value;
        startDate = a.split("/").reverse().join("-");


        var b = document.getElementById('datepicker1').value;
        endDate = b.split("/").reverse().join("-");

        console.log(startDate);
        console.log(endDate);

        var periodStr = a + " " + "to" + " " + b;
        console.log(periodStr);
        var events = [];
        document.getElementById('selectedOUName').innerHTML = orgUnit.name;
        document.getElementById('period').innerHTML = periodStr;

        // prepare table header
        var headerHtml = "<thead  ><tr bgcolor='#F2DDDC' ><th  rowspan='1' ><center>S No.</center></th>" +
                        "<th rowspan='1'><center>Date</center></th>" +
                        "<th rowspan='1'><center>IPC Code</center></th>" +
                        //"<th  rowspan='1'><center>Name</center></th>" +
                        "<th rowspan='1'><center>Target Activity</center></th>" +
                        "<th rowspan='1'><center>Target Provider Code</center></th>" +


                        "<th rowspan='1'><center>Actual Activity</center></th>" +
                        "<th colspan='1'><center>Actual Provider Code</center></th>"+
                        "<th colspan='1'><center>Name</center></th>"+
                        "<th rowspan='1'><center>Variance</center></th></tr>"
                       // "<th rowspan='2'  bgcolor='#F2DDDC'><center>Provider Name</center></th></tr>"

//                        "<tr><th colspan='1' bgcolor='#F2DDDC'>Clients Followed-Up</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>First Client MWRA ID</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>Referral Tokens Issued</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>Last Client MWRA ID</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>Orientation meeting participants</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>Neighbourhood meeting participants</th>"+
//                        "<th colspan='1' bgcolor='#F2DDDC'>Clients visited</th></tr>"


                ;

        headerHtml = headerHtml + "</tr></thead>";
        $('#datavalue1').html("");

        $('#datavalue1').append(headerHtml);
        //	tableDataHtml="";
        tableDataHtml = "<tbody><tr>";


       //IPC workplan
        $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage="+stage1+"&startDate="+startDate+"&endDate="+endDate+"&dimension=ou:"+orgnUnit+"&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function(data) {
            console.log("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage1 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&displayProperty=NAME&desc=EVENTDATE");
            //OM
            $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage2 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (data1) {
                //NM
                $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage3 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (data2) {
                    //HH
                    $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage4 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (data3) {
                        //AM
                        $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage5 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (data4) {
                            //FV
                            $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage6 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (data5) {
                                /* var count = 0, count1 = 0, count2= 0, count3= 0, count4 = 0, d;
                                for(i=0; i<data.rows.length;i++){
                                    for(j=0; j<data1.rows.length;j++){
                                        if(data.rows[i][2] == data1.rows[j][2]){
                                            count++;
                                        }
                                    }
                                }
                                for(i=0; i<data.rows.length;i++){
                                    for(j=0; j<data2.rows.length;j++){
                                        if(data.rows[i][2] == data2.rows[j][2]){
                                            count1++;
                                        }
                                    }
                                }
                                for(i=0; i<data.rows.length;i++){
                                    for(j=0; j<data3.rows.length;j++){
                                        if(data.rows[i][2] == data3.rows[j][2]){
                                            count2++;
                                        }
                                    }
                                }
                                for(i=0; i<data.rows.length;i++){
                                    for(j=0; j<data4.rows.length;j++){
                                        if(data.rows[i][2] == data4.rows[j][2]){
                                            count3++;
                                        }
                                    }
                                }
                                for(i=0; i<data.rows.length;i++){
                                    for(j=0; j<data5.rows.length;j++){
                                        if(data.rows[i][2] == data5.rows[j][2]){
                                            count4++;
                                        }
                                    }
                                }
                                c =(count+count1+count2+count3+count4);
                               d= c-data.rows.length;
                                console.log("count----"+(count+count1+count2+count3+count4));*/
                                populateData(0, data);

                                function completeRow(index, data) {
                                    tableDataHtml = "<tr>" + tableDataHtml + "</tr>";
                                    populateData(index + 1, data);

                                }


                                function populateData(index, data) {
                                    if (index == (data.rows.length)) {
                                        def_stage1.resolve("");
                                        return
                                    }
                                    var i = index;

                                    tableDataHtml = tableDataHtml + "<td><center>" + (i + 1) + "</center></td>";
                                    tableDataHtml = tableDataHtml + "<td><center>" + data.rows[i][2].substring(0, 10) + "</center></td>";// event date
                                    //tableDataHtml = tableDataHtml + "<td><center>" + data.rows[i][5] + "</center></td>";// org unit
                                    tableDataHtml = tableDataHtml + "<td><center>" + data.rows[i][8] + "</center></td>";

                                    if (data.rows[i][10] == '5') {
                                        data.rows[i][10] = 'Neighbourhood meeting';

                                    }
                                    else if (data.rows[i][10] == '2') {
                                        data.rows[i][10] = 'Orientation meeting';
                                    }
                                    tableDataHtml = tableDataHtml + "<td><center>" + data.rows[i][10] + "</center></td>";
                                    tableDataHtml = tableDataHtml + "<td><center>" + data.rows[i][9] + "</center></td>";


                                    if (data.rows[i][10] == 'Orientation meeting') {
                                        for (j = 0; j < data1.rows.length; j++) {
                                            if (data.rows[i][2] == data1.rows[j][2]) { // event date matches
                                                if (data.rows[i][8] == data1.rows[j][8]) { //IPC code matches
                                                    if (data.rows[i][9] == data1.rows[j][9]) { //provider code matches

                                                        variance = 0;
                                                        tableDataHtml = tableDataHtml + "<td><center>" + "Orientation meeting" + "<center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][9] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][10] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                        break;

                                                    }
                                                    else {
                                                        variance = 100;

                                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][10] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                        break;
                                                    }


                                                }
                                                /*   else {
                                                    variance = 100;
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][10] + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                    break;
                                                }*/

                                            }
                                            else { // event date doesnt match
                                                variance = 100;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][10] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                break;
                                            }
                                        }
                                        //if only event date matches, then insert that row of orientation meeting
//                                        if ((data.rows[i][10] == 'Orientation meeting') && (data.rows[i][2] == data1.rows[j][2]) && (data.rows[i][8] != data1.rows[j][8])&&(data.rows[i][9] != data1.rows[j][9]))  { // event date of orientation matches with IPC workplan then insert one row
//
//                                            variance = 100;
//                                            tableDataHtml = tableDataHtml + "<td><center>" + "orientation meeting" + "</center></td>";// activity type
//                                            tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][9] + "</center></td>";// provider code
//                                            tableDataHtml = tableDataHtml + "<td><center>" + data1.rows[j][10] + "</center></td>";//name
//                                            tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";

                                        //                                            // break;
                                        //                                        }

                                    }

                        if(data.rows[i][10] == 'Neighbourhood meeting') {
                                for (var k = 0; k < data2.rows.length; k++) {
                                    if (data.rows[i][2] == data2.rows[k][2]) { // event date matches
                                        if (data.rows[i][8] == data2.rows[k][8]) { //IPC code matches
                                            if (data.rows[i][9] == data2.rows[k][9]) { //provider code matches
//                                        if (data.rows[i][10] == 'Neighbourhood meeting ') {// activity matches
//                                            variance = 0;
//                                            tableDataHtml = tableDataHtml + "<td><center>" + "Neighbourhood meeting" + "</center></td>";
//                                            tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[k][9] + "</center></td>";
                                                //                                            tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                //                                            break;
//                                        }
                                                //   else {
                                                variance = 0;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "Neighbourhood meeting" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10
                                                                ] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" +
                                                        variance + "</center></td>";
                                                break;
                                                //  }
                                            }
                                            else {
                                                variance = 100;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10] + "</enter></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                break;
                                            }


                                        }
                                        else {
                                            variance = 100;
                                            tableDataHtml = tableDataHtml + "<td><center>" + "" + " </center></td>";
                                            tableDataHtml =
                                                    tableDataHtml + "<td><center>" + "" + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10] + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                            break;
                                        }

                                    }
                                    else {
                                        variance = 100;
                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10] + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                        break;
                                    }
                                }
                            //if only event date matches, then insert that row of orientation meeting
//                            if ((data.rows[i][10] == 'Neighbourhood meeting') && (data.rows[i][2] == data2.rows[j][2]) && (data.rows[i][8] != data2.rows[j][8])&&(data.rows[i][9] != data2.rows[j][9]))  { // event date of orientation matches with IPC workplan then insert one row
//
//                                variance = 100; //                                tableDataHtml = tableDataHtml + "<td><center>" + "Neighbourhood meeting" + "</center></td>";// activity type
                            //                                tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][9] + "</center></td>";// provider code//                                tableDataHtml = tableDataHtml + "<td><center>" + data2.rows[j][10] + "</center></td>";//name
//                                tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";

                            //                                // break;
                            //                            }
                            }
                            if(
                                    data.rows[i][10] == 'Household visits') {
                                for (var l = 0
                                        ; l < data3.rows.length; l++) {
                                    if (data.rows[i][2
                                                    ] == data3.rows[l][2]) { // event date matches
                                        if (data.rows[i][8] == data3.rows[l][8]) { //IPC code matches
                                            if ( data3.rows[l][9] == '') {
                                                //no provider code is there in HH visit

                                                variance = 0;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "Household visits" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data3.rows[j][9]  + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data3.rows[j][10] + "</center></td>";
                                                tableDataHtml =


                                                        tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                break;

                                            }
                                            else {
                                                variance = 100;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data3.rows[j][10] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" +
                                                        variance + "</center></td>";
                                                break;
                                            }


                                        }
                                        else {
                                            variance = 100;
                                            tableDataHtml =
                                                    tableDataHtml + "<td><center>" + "" + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                            tableDataHtml = tableDataHtml +
                                                    "<td><center>" + data3.rows[
                                                            j][10
                                                            ] + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                            break;
                                        }

                                    }
                                    else {
                                        variance = 100;
                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + data3.rows[j][10] + "</center></td>";
                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                        break;
                                    }
                                }
                            }
                                    if(data.rows[i][10] ==

                                            'Area mapping'
                                    ) {
                                    for (var m = 0; m < data4.rows.length; m++) {
                                        if (data.rows[i][2] == data4.rows[m][2]) { // event date matches
                                            if (data.rows[i][8] == data4.rows[m][8]) { //IPC code matches
                                                if (data.rows[i][9] == data4.rows[m][9]) { //provider code matches
                                                    variance = 0;
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "Area mapping" + "</center></td>";
                                                    tableDataHtml = tableDataHtml +
                                                            "<td><center>" + data4.rows[j][9] + "</center></td>";
                                                    tableDataHtml =
                                                            tableDataHtml + "<td><center>" + data4.rows[j][10] + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                    break;

                                                }
                                                else {
                                                    variance = 100;
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" +
                                                            "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + data4.rows[j][10]
                                                            + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                    break;
                                                }


                                            }
                                            else {
                                                variance = 100;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + data4.rows[j][10] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                break;
                                            }

                                        }
                                        else {
                                            variance = 100;
                                            tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + data4.rows[j][10] + "</center></td>";
                                            tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                            break;
                                        }
                                    }
                                }
                                    if(data.rows[i][10] == 'Follow-up visits') {
                                        for (var n = 0; n < data5.rows.length; n++) {
                                            if (data.rows[i][2] == data5.rows[n][2]) { // event date matches
                                                if (data.rows[i][8] == data5.rows[n][8]) { //IPC code matches


                                                    if ( data5.rows[n][9] == '') { //no provider code is there in follow up

                                                        variance = 0;
                                                        tableDataHtml = tableDataHtml + "<td><center>" + "Follow-up visits" + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data5.rows[j][9] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data5.rows[j][10] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                        break;

                                                    }
                                                    else {
                                                        variance = 100;
                                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + data5.rows[j][10] + "</center></td>";
                                                        tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                        break;
                                                    }


                                                }
                                                else {
                                                    variance = 100;
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + "" + " </center> </td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + data5.rows[j][10] + "</center></td>";
                                                    tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td>";
                                                    break;
                                                }

                                            }
                                            else {
                                                variance =


                                                        100;
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + "" + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td ><center>" + data5.rows[j][10] + "</center></td>";
                                                tableDataHtml = tableDataHtml + "<td><center>" + variance + "</center></td >";
                                                break;
                                            }
                                        }
                                    }

                        completeRow(index, data);
                                } //IPC workplan
                                $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage="+ stage1+"&startDate="+startDate+"&endDate="+endDate+"&dimension=ou:"+orgnUnit+
                                        "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function(data) {
                              //OM
                                $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage2 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit +
                                        "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (json1) {


                                    populateData_stage2(0, json1);

                                    function completeRow_stage2(index,json1) {

                                        tableDataHtml1 = "<tr>" + tableDataHtml1 + "</tr>";

                                        populateData_stage2(index + 1, json1);

                                    }

                                    function populateData_stage2(index, json1) {
                                        if (index == json1.rows.length) {
                                            def_stage2.resolve("");
                                            return
                                        }
                                        var i = index;

                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + (data.rows.length + i + 1) + "</center></td>";
                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][2].substring(0, 10) + "</center></td>"; // event date
                                        //tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][5] + "</center></td>"; //ou


                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][8] + "</center></td>"; //ipc code

                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + "" + "</center></td>";//
                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + "" + "</center></td>";//
                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + "orientation meeting" + "</center></td>";//
                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][9] + "</center></td>";//
                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][10] + "</center></td>";//
                                        for(j=0;j<data.rows.length;j++){


                                            if((data.rows[j][2] == json1.rows[i][2])&&(data.rows[j][8] == json1.rows[i][8])&&(data.rows[j][9] == json1.rows[i][9])) {
                                                variance = 0;
                                            }
                                            else{
                                                variance =100;
                                            }
                                        }

                                        tableDataHtml1 = tableDataHtml1 + "<td><center>" + variance + "</center></td>";//variance

                                        completeRow_stage2(index, json1);


                                    }
                                    $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage="+ stage1+"&startDate="+startDate+"&endDate="+endDate+"&dimension=ou:"+orgnUnit+
                                            "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function(data) {
                                        //NM
                                        $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage3 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (json2) {

                                            populateData_stage3(0, json2);

                                            function completeRow_stage3(index, json2) {

                                                tableDataHtml2 = "<tr>" + tableDataHtml2 + "</tr>";

                                                populateData_stage3(index + 1, json2);

                                            }

                                            function populateData_stage3(index, json2) {
                                                if (index == json2.rows.length) {
                                                    def_stage3.resolve("");
                                                    return
                                                }
                                                var i = index;

                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + (data.rows.length+json1.rows.length + i + 1) + "</center></td>";
                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + json2.rows[i][2].substring(0, 10) + "</center></td>"; // event date
                                                //tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][5] + "</center></td>"; //ou


                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + json2.rows[i][8] + "</center></td>"; //ipc code

                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + "" + "</center></td>";//
                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + "" + "</center></td>";//
                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + "Neighbourhood meeting" + "</center></td>";//
                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + json2.rows[i][9] + "</center></td>";//
                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + json2.rows[i][10] + "</center></td>";//
                                                for(j=0;j<data.rows.length;j++){


                                                    if((data.rows[j][2] == json2.rows[i][2])&&(data.rows[j][8] == json2.rows[i][8])&&(data.rows[j][9] == json2.rows[i][9])) {
                                                        variance = 0;
                                                    }
                                                    else{
                                                        variance =100;
                                                    }
                                                }


                                                tableDataHtml2 = tableDataHtml2 + "<td><center>" + variance + "</center></td>";//variance

                                                completeRow_stage3(index, json2);


                                            }

                                            $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage=" + stage1 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit +
                                                    "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function (data) {
                                                //HH
                                                $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage4 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (json3) {

                                                    populateData_stage4(0, json3);

                                                    function completeRow_stage4(index, json3) {

                                                        tableDataHtml3 = "<tr>" + tableDataHtml3 + "</tr>";

                                                        populateData_stage4(index + 1, json3);

                                                    }

                                                    function populateData_stage4(index, json3) {
                                                        if (index == json3.rows.length) {
                                                            def_stage4.resolve("");
                                                            return
                                                        }
                                                        var i = index;

                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + (data.rows.length+json1.rows.length+json2.rows.length + i + 1) + "</center></td>";
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + json3.rows[i][2].substring(0, 10) + "</center></td>"; // event date
                                                        //tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][5] + "</center></td>"; //ou


                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + json3.rows[i][8] + "</center></td>"; //ipc code

                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + "" + "</center></td>";//
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + "" + "</center></td>";//
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + "Household visits" + "</center></td>";//
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + json3.rows[i][9] + "</center></td>";//
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + json3.rows[i][10] + "</center></td>";//
                                                        for(j=0;j<data.rows.length;j++){


                                                            if((data.rows[j][2] == json3.rows[i][2])&&(data.rows[j][8] == json3.rows[i][8])) {
                                                                variance = 0;
                                                            }
                                                            else{
                                                                variance =100;
                                                            }
                                                        }
                                                        tableDataHtml3 = tableDataHtml3 + "<td><center>" + variance + "</center></td>";//variance

                                                        completeRow_stage4(index, json3);


                                                    }
                                                    $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage=" + stage1 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit +
                                                            "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function (data) {
                                                        //AM
                                                        $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage5 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (json4) {

                                                            populateData_stage5(0, json4);

                                                            function completeRow_stage5(index, json4) {

                                                                tableDataHtml4 = "<tr>" + tableDataHtml4 + "</tr>";

                                                                populateData_stage5(index + 1, json4);

                                                            }

                                                            function populateData_stage5(index, json4) {
                                                                if (index == json4.rows.length) {
                                                                    def_stage5.resolve("");
                                                                    return
                                                                }
                                                                var i = index;

                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + (data.rows.length+json1.rows.length+json2.rows.length+json3.rows.length + i + 1) + "</center></td>";
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + json4.rows[i][2].substring(0, 10) + "</center></td>"; // event date
                                                                //tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][5] + "</center></td>"; //ou


                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + json4.rows[i][8] + "</center></td>"; //ipc code

                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + "" + "</center></td>";//
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + "" + "</center></td>";//
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + "Area Mapping" + "</center></td>";//
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + json4.rows[i][9] + "</center></td>";//
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + json4.rows[i][10] + "</center></td>";//
                                                                for(j=0;j<data.rows.length;j++){


                                                                    if((data.rows[j][2] == json4.rows[i][2])&&(data.rows[j][8] == json4.rows[i][8])&&(data.rows[j][9] == json4.rows[i][9])) {
                                                                        variance = 0;
                                                                    }
                                                                    else{
                                                                        variance =100;
                                                                    }
                                                                }
                                                                tableDataHtml4 = tableDataHtml4 + "<td><center>" + variance + "</center></td>";//variance

                                                                completeRow_stage5(index, json4);


                                                            }

                                                                    $.get("../api/analytics/events/query/dmTPwDcAsTX.json?stage=" + stage1 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit +
                                                                            "&dimension=RsuC8i6NWFF&dimension=N5ff3MhWQ1J&dimension=Ib3dxl4YfNZ&displayProperty=NAME&desc=EVENTDATE", function (data) {
                                                                        //FV
                                                                        $.get("../api/analytics/events/query/TbYUPaBChYR.json?stage=" + stage6 + "&startDate=" + startDate + "&endDate=" + endDate + "&dimension=ou:" + orgnUnit + "&dimension=zNq2hXkOTga&dimension=sBD5FEalBsU&dimension=MCJaNkHvR4k&displayProperty=NAME&desc=EVENTDATE", function (json6) {

                                                                            populateData_stage6(0, json6);

                                                                            function completeRow_stage6(index, json6) {

                                                                                tableDataHtml5 = "<tr>" + tableDataHtml5 + "</tr>";

                                                                                populateData_stage6(index + 1, json6);

                                                                            }

                                                                            function populateData_stage6(index, json6) {
                                                                                if (index == json6.rows.length) {
                                                                                    def_stage6.resolve("");
                                                                                    return
                                                                                }
                                                                                var i = index;

                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + (data.rows.length+json1.rows.length+json2.rows.length+json3.rows.length+json4.rows.length+ i + 1) + "</center></td>";
                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + json6.rows[i][2].substring(0, 10) + "</center></td>"; // event date
                                                                                //tableDataHtml1 = tableDataHtml1 + "<td><center>" + json1.rows[i][5] + "</center></td>"; //ou


                                                                                tableDataHtml5= tableDataHtml5 + "<td><center>" + json6.rows[i][8] + "</center></td>"; //ipc code

                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + "" + "</center></td>";//
                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + "" + "</center></td>";//
                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + "Follow-up visits" + "</center></td>";//
                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + json6.rows[i][9] + "</center></td>";//
                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + json6.rows[i][10] + "</center></td>";//
                                                                                for(j=0;j<data.rows.length;j++){


                                                                                    if((data.rows[j][2] == json6.rows[i][2])&&(data.rows[j][8] == json6.rows[i][8])) {
                                                                                        variance = 0;
                                                                                    }
                                                                                    else{
                                                                                        variance =100;
                                                                                    }
                                                                                }

                                                                                tableDataHtml5 = tableDataHtml5 + "<td><center>" + variance + "</center></td>";//variance

                                                                                completeRow_stage6(index, json6);


                                                                            }

                                                                       // });
                                                                   // });
                                                        });
                                                    });
                                                });
                                            });
                                        });
                                    });
                                });
                                });
                                });

            });
        });
                });
                });   });   });
});
        $.when(def_stage1,def_stage2,def_stage3,def_stage4,def_stage5,def_stage6).done(function(){
            $('#datavalue1').append(tableDataHtml,tableDataHtml1,tableDataHtml2,tableDataHtml3,tableDataHtml4,tableDataHtml5);

        });


        // });


    }





</script>


<script type="text/javascript">
    function printContent(el) {
        var restorepage = document.body.innerHTML;
        var printcontent = document.getElementById(el).innerHTML;
        document.body.innerHTML = printcontent;
        window.print();
        document.body.innerHTML = restorepage;
    }
</script>
<p><span style="font-size:12px;">
<style>
    th {
        text-align: center;
    }

    td {
        padding: 3px 7px;

    }

    .bd {
        border-style: solid;
        border-color: #000000;
    }

    #cover {
        position: fixed;
        top: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 5;
        width: 100%;
        height: 100%;
    }

    #loads {
        height: 100px;
        width: 500px;
        position: fixed;
        z-index: 10;
        margin: 0 auto;
        top: 50%;
        left: 50%;
        margin-top: -50px;
        margin-left: -250px;
        background: #999;
        border: 5px solid #cccccc;
        text-align : center;
        border-radius: 5px;
    }

    .loading {
        width: 400px;
        font-size: 20px;
        font-family: verdana;
        font-weight: bolder;
        position: fixed;
        top: 50%;
        left: 50%;
        margin: 0 auto;
        margin-top: -8px;
        margin-left: -200px;
    }




</style>

</span></p>
<table>
    <tr>
        <td>
            <input type="button" id="btnBack" value=" Go to Dashboard"
                   onclick="location.href='../dhis-web-dashboard-integration/index.action'"/>
            <input type="button" onclick="printContent('printing');" value="Print"/>
            <!--<input type="button" id="btnExport" value=" Download Excel " />-->

        </td>
    </tr>
</table>

<table>
    <tr>
        <td>Start Date:</td>
        <td>End Date:</td>
    </tr>
    <tr>
        <td><input type="text" id="datepicker"></td>
        <td><input type="text" id="datepicker1"></td>
        <td><input type="button" onClick="loadDataX()" value="go" style="width:30px"/></td>
    </tr>
</table>
<!--<select id="workerdropdown" style=" margin-left:10%">
    <option selected value="base">Please Select Worker</option>

</select>-->
</br></br>
</br></br>

<div id="printing">
    <table>
        <tr>
            <td>
                <table border="1" cellspacing="6" cellpadding="4" width="100%"
                       style="border-collapse:collapse; border:2px; font-weight:bolder">
                    <thead>
                    <tr align="center" height="27">
                        <td colspan="30" width="2082" height="27" class="col" bgcolor="#32849C"><font color="white"><b>Variance Report
                        </b></font></td>
                    </tr>
                    <tr bgcolor="#F2DDDC" align="center" height="20">
                        <td colspan="1" height="20" align="right"><b>Parent OU:</b></td>
                        <td colspan="2" id="selectedOUName">&nbsp;</td>
                        <td colspan="5">&nbsp;</td>
                        <td colspan="1" align="right"><b>Month: </b></td>
                        <td colspan="2" id="period">&nbsp;</td>
                    </tr>
                    </thead>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <table id="datavalue1" border="1" cellspacing="6" cellpadding="4" width="100%"
                       style="border-collapse:collapse; border:2px; font-weight:bolder;
    border-spacing: 0;">
                </table>
            </td>
        </tr>
    </table>
</div>